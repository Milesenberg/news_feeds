<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Beat Sequencer v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom scrollbar for the grid */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div class="mb-6 text-center">
        <h1
            class="text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 transform -skew-x-12">
            BIG BEAT BRICK
        </h1>
        <p class="text-gray-400 mt-2">Analogue Rhythm Construction Kit</p>
    </div>

    <!-- Init Button -->
    <button id="init-btn"
        class="bg-pink-600 hover:bg-pink-500 text-white font-bold py-8 px-12 rounded-lg text-2xl shadow-[0_0_30px_rgba(236,72,153,0.5)] transition-all transform hover:scale-105 animate-pulse">
        INITIALISE AUDIO SYSTEM
    </button>

    <!-- Main Interface (Hidden initially) -->
    <div id="main-interface"
        class="hidden w-full max-w-5xl bg-gray-800 rounded-xl shadow-2xl border border-gray-700 overflow-hidden">

        <!-- Top Controls -->
        <div class="bg-gray-900 p-4 border-b border-gray-700 flex flex-wrap gap-4 justify-between items-center">
            <div class="flex items-center gap-2">
                <button id="play-btn"
                    class="flex items-center gap-2 px-6 py-3 rounded font-bold transition-all bg-green-600 hover:bg-green-500">
                    <i data-lucide="play" class="w-5 h-5 fill-current"></i>
                    <span>PLAY</span>
                </button>
                <button id="clear-btn" class="p-3 bg-gray-700 hover:bg-gray-600 rounded text-gray-300"
                    title="Clear Pattern">
                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="flex items-center gap-6 bg-gray-800 px-4 py-2 rounded-lg border border-gray-700">
                <div class="flex flex-col items-center">
                    <span class="text-xs text-cyan-400 font-bold mb-1">BPM</span>
                    <input type="number" id="bpm-input" value="125"
                        class="w-16 bg-gray-900 border border-cyan-900 text-cyan-400 text-center font-bold rounded focus:outline-none">
                </div>

                <div class="flex flex-col items-center w-32">
                    <div class="flex items-center gap-1 mb-1">
                        <i data-lucide="volume-2" class="w-3 h-3 text-green-400"></i>
                        <span class="text-xs text-green-400 font-bold">MASTER VOL</span>
                    </div>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.8"
                        class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-green-500">
                </div>

                <!-- Export Button -->
                <div class="flex flex-col items-center border-l border-gray-700 pl-6">
                    <div class="flex items-center gap-1 mb-1">
                        <i id="export-icon" data-lucide="download" class="w-3 h-3 text-gray-400"></i>
                        <span id="export-label" class="text-xs font-bold text-gray-400">EXPORT AUDIO</span>
                    </div>
                    <button id="export-btn"
                        class="w-full py-1 px-3 rounded text-xs font-bold transition-colors bg-gray-700 hover:bg-gray-600 text-gray-300">
                        REC OUTPUT
                    </button>
                </div>
            </div>
        </div>

        <!-- Effects Rack -->
        <div class="bg-gray-850 p-4 border-b border-gray-700 flex flex-wrap gap-6 justify-center bg-black/30">
            <!-- Filter -->
            <div class="flex flex-col w-full md:w-64 group">
                <div class="flex justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <i data-lucide="sliders" class="w-4 h-4 text-yellow-400"></i>
                        <span class="text-sm font-bold text-yellow-400">FILTER CUTOFF</span>
                    </div>
                    <span class="text-xs text-gray-500 font-mono">LPF</span>
                </div>
                <input type="range" id="filter-slider" min="50" max="10000" step="10" value="20000"
                    class="w-full h-4 bg-gray-900 rounded-lg appearance-none cursor-pointer accent-yellow-400 border border-gray-700">
            </div>
            <!-- Distortion -->
            <div class="flex flex-col w-full md:w-64 group">
                <div class="flex justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <i data-lucide="zap" class="w-4 h-4 text-red-500"></i>
                        <span class="text-sm font-bold text-red-500">DIRT (DRIVE)</span>
                    </div>
                    <span class="text-xs text-gray-500 font-mono">ANALOGUE</span>
                </div>
                <input type="range" id="distortion-slider" min="0" max="100" step="1" value="20"
                    class="w-full h-4 bg-gray-900 rounded-lg appearance-none cursor-pointer accent-red-500 border border-gray-700">
            </div>
            <!-- Sampler Controls -->
            <div class="flex flex-col w-full md:w-64 group border-l border-gray-700 pl-6">
                <div class="flex justify-between mb-2">
                    <div class="flex items-center gap-2">
                        <i data-lucide="mic" class="w-4 h-4 text-orange-500"></i>
                        <span class="text-sm font-bold text-orange-500">SAMPLER</span>
                    </div>
                    <span id="sampler-status" class="text-xs text-gray-500 font-mono">EMPTY</span>
                </div>
                <div class="flex gap-3 items-center">
                    <!-- Recording Controls -->
                    <div class="flex gap-1">
                        <button id="record-btn" title="Record Microphone"
                            class="flex items-center justify-center w-10 h-10 rounded font-bold border bg-gray-800 border-gray-600 text-gray-300 hover:bg-gray-700 transition-colors">
                            <i data-lucide="mic" class="w-4 h-4"></i>
                        </button>
                        <button id="upload-btn" title="Upload File (MP3/MP4/WAV)"
                            class="flex items-center justify-center w-10 h-10 rounded font-bold border bg-gray-800 border-gray-600 text-gray-300 hover:bg-gray-700 transition-colors">
                            <i data-lucide="upload" class="w-4 h-4"></i>
                        </button>
                        <input type="file" id="file-input" accept="audio/*,video/mp4,video/webm" class="hidden">
                    </div>
                    <!-- Pitch Slider -->
                    <div class="flex-1">
                        <span class="text-[10px] text-orange-400 block mb-1 text-center">PITCH / SPEED</span>
                        <input type="range" id="pitch-slider" min="0.2" max="2.0" step="0.1" value="1.0"
                            class="w-full h-2 bg-gray-900 rounded-lg appearance-none cursor-pointer accent-orange-500">
                    </div>
                </div>
            </div>
        </div>

        <!-- Sequencer Grid -->
        <div class="p-6 overflow-x-auto">
            <div class="min-w-[1200px]">
                <!-- Step Indicators -->
                <div class="flex mb-2">
                    <div class="w-32"></div>
                    {% for i in range(32) %}
                    <div id="step-indicator-{{ i }}"
                        class="flex-1 h-2 mx-0.5 rounded-full transition-all duration-75 {{ 'bg-gray-500' if i % 8 == 0 else ('bg-gray-600' if i % 4 == 0 else 'bg-gray-800') }}">
                    </div>
                    {% endfor %}
                </div>

                <!-- Instrument Rows -->
                {% set instruments = [
                {'name': 'KICK', 'color': 'text-pink-500', 'class': 'text-pink-500'},
                {'name': 'SNARE', 'color': 'text-cyan-400', 'class': 'text-cyan-400'},
                {'name': 'HI-HAT (C)', 'color': 'text-yellow-400', 'class': 'text-yellow-400'},
                {'name': 'HI-HAT (O)', 'color': 'text-yellow-200', 'class': 'text-yellow-200'},
                {'name': 'ACID BASS', 'color': 'text-green-500', 'class': 'text-green-500'},
                {'name': 'RAVE STAB', 'color': 'text-purple-500', 'class': 'text-purple-500'},
                {'name': 'VOCAL/SAMPLE', 'color': 'text-orange-500', 'class': 'text-orange-500'}
                ] %}

                {% for row_idx in range(7) %}
                <div class="flex mb-2 items-center">
                    <!-- Instrument Label -->
                    <div
                        class="w-32 font-bold text-sm tracking-wider {{ instruments[row_idx].class }} flex items-center gap-2">
                        <i data-lucide="activity" class="w-3.5 h-3.5"></i>
                        {{ instruments[row_idx].name }}
                    </div>

                    <!-- Steps -->
                    <div class="flex-1 flex">
                        {% for col_idx in range(32) %}
                        <button id="cell-{{ row_idx }}-{{ col_idx }}"
                            onclick="toggleGridStep({{ row_idx }}, {{ col_idx }})"
                            class="flex-1 aspect-square mx-0.5 rounded-sm transition-all duration-100 border border-gray-700 bg-gray-800 hover:bg-gray-700 {{ 'border-l-2 border-l-white' if col_idx % 16 == 0 else ('border-l-gray-600' if col_idx % 4 == 0 else '') }} {{ instruments[row_idx].class }}"></button>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="bg-gray-900 px-6 py-3 text-xs text-gray-500 flex justify-between border-t border-gray-800">
            <span>MILES'S BIG BEAT MACHINE v2.0 (EXPANDED)</span>
            <span>STEREO OUTPUT • 44.1KHZ • 32 STEPS</span>
        </div>
    </div>

    <script src="{{ url_for('sequencer.static', filename='sequencer.js') }}"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>